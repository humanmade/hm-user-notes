(()=>{"use strict";(()=>{const e=window.wp.i18n;function t(t,n){let o=t.querySelector(".hm-user-note-indicator");if(!o){o=document.createElement("div"),o.className="hm-user-note-indicator";const e=t.querySelector("#comment");e&&e.parentNode.appendChild(o)}const r={saving:(0,e.__)("Savingâ€¦","hm-user-notes"),saved:(0,e.__)("Saved","hm-user-notes"),error:(0,e.__)("Error saving","hm-user-notes")};o.textContent=r[n]||"",o.className=`hm-user-note-indicator hm-user-note-indicator--${n}`,"saved"!==n&&"error"!==n||setTimeout(()=>{o.textContent="",o.className="hm-user-note-indicator"},2e3)}function n(){document.querySelectorAll(".hm-user-note-form form.comment-form").forEach(e=>{const n=e.querySelector("#comment"),o=e.querySelector('[type="submit"]');o&&(o.style.display="none");const r=document.createElement("input");r.type="hidden",r.name="hm_user_note",r.value="1",e.appendChild(r);const s=function(){let o;return function(...r){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),(()=>{if(!n)return;const o=n.value.trim();if(!o)return;t(e,"saving");const r=window.hmUserNotes?.existingNote?.id,s=window.hmUserNotes?.postId;!function(e,n,o,r){const s=!!n,i=s?`/wp-json/wp/v2/comments/${n}`:"/wp-json/wp/v2/comments",c=s?{content:e}:{content:e,post:o,author:window.hmUserNotes?.userId};fetch(i,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":window.hmUserNotes?.nonce||"","X-HM-User-Note":1},body:JSON.stringify(c)}).then(e=>{if(e.ok)return e.json();throw new Error("Save failed")}).then(n=>{if(t(r,"saved"),!s&&n.id){window.hmUserNotes&&(window.hmUserNotes.existingNote={id:n.id,content:e});const t=r.querySelector("#comment_ID");t&&(t.value=n.id)}else window.hmUserNotes?.existingNote&&(window.hmUserNotes.existingNote.content=e)}).catch(e=>{console.error("Error saving note:",e),t(r,"error")})}(o,r,s,e)})(...r)},1e3)}}();n&&n.addEventListener("keyup",s),e.addEventListener("submit",e=>(e.preventDefault(),!1))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})()})();